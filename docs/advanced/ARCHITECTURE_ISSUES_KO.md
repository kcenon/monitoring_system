# Architecture Issues - Phase 0 식별

> **Language:** [English](ARCHITECTURE_ISSUES.md) | **한국어**

## 목차

- [개요](#개요)
- [문제 범주](#문제-범주)
  - [1. 테스팅 및 품질](#1-테스팅-및-품질)
    - [Issue ARC-001: 낮은 테스트 커버리지](#issue-arc-001-낮은-테스트-커버리지)
    - [Issue ARC-002: 성능 벤치마크 누락](#issue-arc-002-성능-벤치마크-누락)
  - [2. 동시성 및 스레드 안전성](#2-동시성-및-스레드-안전성)
    - [Issue ARC-003: 모니터 스레드 안전성 검증](#issue-arc-003-모니터-스레드-안전성-검증)
  - [3. 성능 및 최적화](#3-성능-및-최적화)
    - [Issue ARC-004: 메트릭 수집 오버헤드](#issue-arc-004-메트릭-수집-오버헤드)
    - [Issue ARC-005: Adaptive Monitor 임계값 튜닝](#issue-arc-005-adaptive-monitor-임계값-튜닝)
  - [4. 기능 및 기능성](#4-기능-및-기능성)
    - [Issue ARC-006: 분산 추적 불완전](#issue-arc-006-분산-추적-불완전)
    - [Issue ARC-007: 제한된 메트릭 유형](#issue-arc-007-제한된-메트릭-유형)
  - [5. 문서화](#5-문서화)
    - [Issue ARC-008: 불완전한 API 문서](#issue-arc-008-불완전한-api-문서)
    - [Issue ARC-009: 통합 예제 누락](#issue-arc-009-통합-예제-누락)
  - [6. 통합](#6-통합)
    - [Issue ARC-010: Common System 통합](#issue-arc-010-common-system-통합)
- [문제 추적](#문제-추적)
  - [Phase 0 작업](#phase-0-작업)
  - [Phase 1 작업](#phase-1-작업)
  - [Phase 2 작업](#phase-2-작업)
  - [Phase 3 작업](#phase-3-작업)
  - [Phase 4 작업](#phase-4-작업)
  - [Phase 5 작업](#phase-5-작업)
  - [Phase 6 작업](#phase-6-작업)
- [위험 평가](#위험-평가)
- [참조](#참조)

**문서 버전**: 1.0
**날짜**: 2025-10-05
**시스템**: monitoring_system
**상태**: 문제 추적 문서

---

## 개요

본 문서는 Phase 0 분석 중 monitoring_system에서 식별된 알려진 아키텍처 문제를 목록화합니다. 문제는 우선순위가 지정되며 해결을 위한 특정 단계에 매핑됩니다.

---

## 문제 범주

### 1. 테스팅 및 품질

#### Issue ARC-001: 낮은 테스트 커버리지
- **우선순위**: P0 (높음)
- **단계**: Phase 5
- **설명**: 현재 테스트 커버리지 65%, 80% 목표 미달
- **영향**: 알 수 없는 코드 품질, 잠재적 버그
- **조사 필요 사항**:
  - 테스트되지 않은 코드 경로 식별
  - 엣지 케이스에 대한 테스트 추가
  - 통합 테스트 커버리지 개선
- **수락 기준**: 커버리지 >80%, 모든 중요 경로 테스트됨

#### Issue ARC-002: 성능 벤치마크 누락
- **우선순위**: P1 (중간)
- **단계**: Phase 2
- **설명**: 성능 벤치마크 스위트 없음
- **영향**: 최적화 개선 측정 불가
- **조사 필요 사항**:
  - 모든 모니터에 대한 벤치마크 스위트 생성
  - 메트릭 수집 오버헤드 프로파일링
  - 대체 모니터링 솔루션과 비교
- **수락 기준**: 기준선 메트릭이 있는 완전한 벤치마크 스위트

---

### 2. 동시성 및 스레드 안전성

#### ~~Issue ARC-003: 모니터 스레드 안전성 검증~~ ✅ 해결됨
- **우선순위**: P0 (높음)
- **단계**: Phase 1
- **상태**: ✅ **해결됨** (2025-11-26)
- **설명**: 모든 모니터 구현에 스레드 안전성 검증 필요
- **영향**: 동시 모니터링에서 잠재적 데이터 경합
- **해결 내용**:
  - ✅ performance_monitor 동기화 검토 완료
  - ✅ adaptive_monitor 원자적 연산 확인 완료
  - ✅ 메트릭 집계 스레드 안전성 검증 완료
  - ✅ ThreadSanitizer 검증을 위한 thread_safety_tests.cpp 추가
- **참조**:
  - 테스트: `tests/thread_safety_tests.cpp`
  - Sanitizer 워크플로우: `.github/workflows/sanitizers.yml`

---

### 3. 성능 및 최적화

#### Issue ARC-004: 메트릭 수집 오버헤드
- **우선순위**: P1 (중간)
- **단계**: Phase 2
- **설명**: 메트릭 수집 오버헤드 특성화 및 최소화 필요
- **영향**: 모니터링되는 애플리케이션에 잠재적 성능 영향
- **조사 필요 사항**:
  - 수집 오버헤드 프로파일링
  - 핫 패스 최적화
  - 배칭 전략 구현
- **수락 기준**: 메트릭당 <10μs 오버헤드, 문서화됨

#### ~~Issue ARC-005: Adaptive Monitor 임계값 튜닝~~ ✅ 해결됨
- **우선순위**: P1 (중간)
- **단계**: Phase 2
- **상태**: ✅ **해결됨** (2025-11-27)
- **설명**: Adaptive monitor 임계값 알고리즘 검증 필요
- **영향**: 차선책 알림 트리거링
- **해결 내용**:
  - ✅ 임계값 경계에서 진동 방지를 위한 히스테리시스 구현
  - ✅ 급격한 레벨 변경 방지를 위한 쿨다운 기간 추가
  - ✅ 다양한 워크로드 시나리오에서 임계값 검증
  - ✅ 점진적, 스파이크, 진동 부하에 대한 포괄적인 테스트 추가
- **새 설정 파라미터**:
  - `hysteresis_margin`: 진동 방지를 위한 퍼센트 마진 (기본값: 5.0%)
  - `cooldown_period`: 레벨 변경 간 최소 시간 (기본값: 1000ms)
  - `enable_hysteresis`: 히스테리시스 활성화/비활성화 (기본값: true)
  - `enable_cooldown`: 쿨다운 활성화/비활성화 (기본값: true)
- **참조**:
  - 구현: `src/impl/adaptive_monitor.h`
  - 테스트: `tests/test_adaptive_monitoring.cpp` (12개의 새로운 워크로드 시나리오 테스트)

---

### 4. 기능 및 기능성

#### Issue ARC-006: 분산 추적 불완전
- **우선순위**: P1 (중간)
- **단계**: Phase 4
- **설명**: 분산 추적 구현 완료 필요
- **영향**: 분산 시스템에서 제한된 관찰성
- **조사 필요 사항**:
  - 추적 컨텍스트 전파 완료
  - 추적 집계 구현
  - 분산 추적 시각화 추가
- **수락 기준**: 완전한 분산 추적 지원

#### ~~Issue ARC-007: 제한된 메트릭 유형~~ ✅ 해결됨
- **우선순위**: P2 (낮음)
- **단계**: Phase 4
- **상태**: ✅ **해결됨** (2025-11-27)
- **설명**: 추가 메트릭 유형 지원 필요
- **영향**: 제한된 모니터링 기능
- **해결 내용**:
  - ✅ 설정 가능한 버킷의 히스토그램 메트릭 (`histogram_data`)
  - ✅ min/max/mean이 있는 요약 메트릭 (`summary_data`)
  - ✅ 백분위수가 있는 타이머 메트릭 (`timer_data`)
    - 메모리 효율성을 위한 Reservoir 샘플링
    - p50, p90, p95, p99, p999 백분위수 계산
    - 표준 편차 및 스냅샷 지원
  - ✅ 자동 시간 측정을 위한 RAII scoped_timer
  - ✅ `test_timer_metrics.cpp`의 포괄적인 테스트
- **참조**:
  - 구현: `include/kcenon/monitoring/utils/metric_types.h`
  - 테스트: `tests/test_timer_metrics.cpp`

---

### 5. 문서화

#### Issue ARC-008: 불완전한 API 문서
- **우선순위**: P1 (중간)
- **단계**: Phase 6
- **설명**: 공개 인터페이스에 포괄적인 Doxygen 주석 부족
- **영향**: 개발자 온보딩 어려움, API 오용
- **요구 사항**:
  - 모든 공개 API에 Doxygen 주석
  - 주석에 사용 예제
  - 오류 조건 문서화
  - 스레드 안전성 보장 명시
- **수락 기준**: 100% 공개 API 문서화됨

#### Issue ARC-009: 통합 예제 누락
- **우선순위**: P2 (낮음)
- **단계**: Phase 6
- **설명**: 통합 시나리오에 대한 더 많은 예제 필요
- **영향**: 개발자가 일반적인 사용 사례에서 어려움을 겪을 수 있음
- **요구 사항**:
  - 각 모니터 유형에 대한 예제
  - logger_system과의 통합 예제
  - 사용자 정의 메트릭 예제
  - 분산 추적 예제
- **수락 기준**: examples/의 완전한 예제 스위트

---

### 6. 통합

#### ~~Issue ARC-010: Common System 통합~~ ✅ 해결됨
- **우선순위**: P1 (중간)
- **단계**: Phase 3
- **상태**: ✅ **해결됨** (2025-11-27)
- **설명**: common_system과의 통합 검증 필요
- **영향**: 잠재적 비호환성 또는 차선책 통합
- **해결**:
  - ✅ `common_system_adapter.h`를 통해 IMonitor 구현 준수 검증
  - ✅ Result<T> 사용 패턴 검증 - 적절한 변환과 함께 `common::Result<T>` 사용
  - ✅ 오류 코드 정렬 문서화 (monitoring_system은 양수 코드 사용, 어댑터에서 변환 처리)
  - ✅ `test_cross_system_integration.cpp`를 테스트 스위트에 추가
  - ✅ 8개의 크로스 시스템 통합 테스트 모두 통과
- **참조**:
  - 어댑터: `include/kcenon/monitoring/adapters/common_system_adapter.h`
  - 테스트: `tests/test_cross_system_integration.cpp`
  - Result 타입: `include/kcenon/monitoring/core/result_types.h`

---

## 문제 추적

### Phase 0 작업
- [x] 모든 아키텍처 문제 식별
- [x] 문제 우선순위 지정
- [x] 문제를 단계에 매핑
- [ ] 기준선 메트릭 문서화

### Phase 1 작업
- [x] ARC-003 해결 (모니터 스레드 안전성) - 2025-11-26

### Phase 2 작업
- [x] ARC-002 해결 (성능 벤치마크) - 2025-11-26
- [x] ARC-004 해결 (수집 오버헤드) - 2025-11-26
- [x] ARC-005 해결 (Adaptive 임계값 튜닝) - 2025-11-27

### Phase 3 작업
- [x] ARC-010 해결 (Common system 통합) - 2025-11-27

### Phase 4 작업
- [ ] ARC-006 해결 (분산 추적)
- [x] ARC-007 해결 (메트릭 유형) - 2025-11-27

### Phase 5 작업
- [ ] ARC-001 해결 (테스트 커버리지)

### Phase 6 작업
- [ ] ARC-008 해결 (API 문서)
- [ ] ARC-009 해결 (통합 예제)

---

## 위험 평가

| 문제 | 확률 | 영향 | 위험 수준 |
|------|------|------|-----------|
| ARC-001 | 높음 | 높음 | 치명적 |
| ARC-002 | 높음 | 중간 | 높음 |
| ARC-003 | 중간 | 높음 | 높음 |
| ARC-004 | 중간 | 중간 | 중간 |
| ARC-005 | 중간 | 중간 | 중간 |
| ARC-006 | 낮음 | 중간 | 낮음 |
| ARC-007 | 낮음 | 낮음 | 낮음 |
| ARC-008 | 높음 | 중간 | 중간 |
| ARC-009 | 낮음 | 낮음 | 낮음 |
| ARC-010 | 중간 | 중간 | 중간 |

---

## 참조

- [CURRENT_STATE.md](./CURRENT_STATE.md)
- [ARCHITECTURE_GUIDE.md](./ARCHITECTURE_GUIDE.md)
- [API_REFERENCE.md](./API_REFERENCE.md)

---

**문서 유지 관리자**: 아키텍처 팀
**다음 검토**: 각 단계 완료 후

---

*Last Updated: 2025-11-27 (ARC-003, ARC-007 해결됨)*
