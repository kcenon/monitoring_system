<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Monitoring System: tests/test_hot_path_helper.cpp File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Monitoring System
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_59425e443f801f1f2fd8bbe4959a3ccf.html">tests</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">test_hot_path_helper.cpp File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Unit tests for hot-path optimization helpers.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;gtest/gtest.h&gt;</code><br />
<code>#include &lt;<a class="el" href="../../d2/de0/hot__path__helper_8h_source.html">kcenon/monitoring/utils/hot_path_helper.h</a>&gt;</code><br />
<code>#include &lt;atomic&gt;</code><br />
<code>#include &lt;memory&gt;</code><br />
<code>#include &lt;string&gt;</code><br />
<code>#include &lt;thread&gt;</code><br />
<code>#include &lt;unordered_map&gt;</code><br />
<code>#include &lt;vector&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for test_hot_path_helper.cpp:</div>
<div class="dyncontent">
<div class="center"><img src="../../d8/d08/test__hot__path__helper_8cpp__incl.png" border="0" usemap="#atests_2test__hot__path__helper_8cpp" alt=""/></div>
<map name="atests_2test__hot__path__helper_8cpp" id="atests_2test__hot__path__helper_8cpp">
<area shape="rect" title="Unit tests for hot&#45;path optimization helpers." alt="" coords="435,5,581,45"/>
<area shape="rect" title=" " alt="" coords="5,101,109,126"/>
<area shape="poly" title=" " alt="" coords="435,39,290,63,122,96,107,100,106,94,121,91,289,57,434,34"/>
<area shape="rect" href="../../d2/de0/hot__path__helper_8h.html" title="Reusable hot&#45;path optimization patterns for concurrent map access." alt="" coords="133,93,309,133"/>
<area shape="poly" title=" " alt="" coords="446,48,298,92,297,87,444,43"/>
<area shape="rect" title=" " alt="" coords="333,101,400,126"/>
<area shape="poly" title=" " alt="" coords="478,48,398,96,396,91,476,43"/>
<area shape="rect" title=" " alt="" coords="424,101,501,126"/>
<area shape="poly" title=" " alt="" coords="500,47,478,89,473,87,496,44"/>
<area shape="rect" title=" " alt="" coords="525,101,584,126"/>
<area shape="poly" title=" " alt="" coords="521,44,544,87,539,90,516,47"/>
<area shape="rect" title=" " alt="" coords="608,101,672,126"/>
<area shape="poly" title=" " alt="" coords="539,43,612,91,609,95,536,48"/>
<area shape="rect" title=" " alt="" coords="697,101,821,126"/>
<area shape="poly" title=" " alt="" coords="564,43,713,94,712,99,562,48"/>
<area shape="rect" title=" " alt="" coords="845,101,907,126"/>
<area shape="poly" title=" " alt="" coords="582,35,701,57,834,91,841,93,839,98,833,96,700,62,581,40"/>
<area shape="rect" title=" " alt="" coords="164,181,279,207"/>
<area shape="poly" title=" " alt="" coords="224,134,224,167,219,167,219,134"/>
</map>
</div>
</div>
<p><a href="../../d4/d38/test__hot__path__helper_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d76/classHotPathHelperTest.html">HotPathHelperTest</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ad740efc2ee33f79991c2491efa2035d3" id="r_ad740efc2ee33f79991c2491efa2035d3"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d38/test__hot__path__helper_8cpp.html#ad740efc2ee33f79991c2491efa2035d3">TEST_F</a> (<a class="el" href="../../de/d76/classHotPathHelperTest.html">HotPathHelperTest</a>, GetOrCreateNewEntry)</td></tr>
<tr class="separator:ad740efc2ee33f79991c2491efa2035d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9088ee1dc8186e725e0e0ccc7dcb7de6" id="r_a9088ee1dc8186e725e0e0ccc7dcb7de6"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d38/test__hot__path__helper_8cpp.html#a9088ee1dc8186e725e0e0ccc7dcb7de6">TEST_F</a> (<a class="el" href="../../de/d76/classHotPathHelperTest.html">HotPathHelperTest</a>, GetOrCreateExistingEntry)</td></tr>
<tr class="separator:a9088ee1dc8186e725e0e0ccc7dcb7de6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9605b99a2b4f6748fcfaf09829f14150" id="r_a9605b99a2b4f6748fcfaf09829f14150"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d38/test__hot__path__helper_8cpp.html#a9605b99a2b4f6748fcfaf09829f14150">TEST_F</a> (<a class="el" href="../../de/d76/classHotPathHelperTest.html">HotPathHelperTest</a>, GetOrCreateMultipleKeys)</td></tr>
<tr class="separator:a9605b99a2b4f6748fcfaf09829f14150"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a391e73dc7d0f9619ff60cb78c89a0bac" id="r_a391e73dc7d0f9619ff60cb78c89a0bac"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d38/test__hot__path__helper_8cpp.html#a391e73dc7d0f9619ff60cb78c89a0bac">TEST_F</a> (<a class="el" href="../../de/d76/classHotPathHelperTest.html">HotPathHelperTest</a>, GetOrCreateWithInitNewEntry)</td></tr>
<tr class="separator:a391e73dc7d0f9619ff60cb78c89a0bac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa9f263e7c0939fc35bc877d33e2876f8" id="r_aa9f263e7c0939fc35bc877d33e2876f8"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d38/test__hot__path__helper_8cpp.html#aa9f263e7c0939fc35bc877d33e2876f8">TEST_F</a> (<a class="el" href="../../de/d76/classHotPathHelperTest.html">HotPathHelperTest</a>, GetOrCreateWithInitExistingEntry)</td></tr>
<tr class="separator:aa9f263e7c0939fc35bc877d33e2876f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad8aa72525bcd43b0e59f76a73cbb112c" id="r_ad8aa72525bcd43b0e59f76a73cbb112c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d38/test__hot__path__helper_8cpp.html#ad8aa72525bcd43b0e59f76a73cbb112c">TEST_F</a> (<a class="el" href="../../de/d76/classHotPathHelperTest.html">HotPathHelperTest</a>, GetOrCreateAndUpdateNewEntry)</td></tr>
<tr class="separator:ad8aa72525bcd43b0e59f76a73cbb112c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad052b7b4dc32eae0b04fb368174c2415" id="r_ad052b7b4dc32eae0b04fb368174c2415"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d38/test__hot__path__helper_8cpp.html#ad052b7b4dc32eae0b04fb368174c2415">TEST_F</a> (<a class="el" href="../../de/d76/classHotPathHelperTest.html">HotPathHelperTest</a>, GetOrCreateAndUpdateExistingEntry)</td></tr>
<tr class="separator:ad052b7b4dc32eae0b04fb368174c2415"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac327b84053ff57cb897b2b80f6fd3104" id="r_ac327b84053ff57cb897b2b80f6fd3104"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d38/test__hot__path__helper_8cpp.html#ac327b84053ff57cb897b2b80f6fd3104">TEST_F</a> (<a class="el" href="../../de/d76/classHotPathHelperTest.html">HotPathHelperTest</a>, ConcurrentGetOrCreate)</td></tr>
<tr class="separator:ac327b84053ff57cb897b2b80f6fd3104"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a79be2172d6e9a1246721691a09cc23e7" id="r_a79be2172d6e9a1246721691a09cc23e7"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d38/test__hot__path__helper_8cpp.html#a79be2172d6e9a1246721691a09cc23e7">TEST_F</a> (<a class="el" href="../../de/d76/classHotPathHelperTest.html">HotPathHelperTest</a>, ConcurrentDifferentKeys)</td></tr>
<tr class="separator:a79be2172d6e9a1246721691a09cc23e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a58571a0ac5f0ebf89e8041a9b79bfbeb" id="r_a58571a0ac5f0ebf89e8041a9b79bfbeb"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d38/test__hot__path__helper_8cpp.html#a58571a0ac5f0ebf89e8041a9b79bfbeb">TEST_F</a> (<a class="el" href="../../de/d76/classHotPathHelperTest.html">HotPathHelperTest</a>, ConcurrentMixedReadWrite)</td></tr>
<tr class="separator:a58571a0ac5f0ebf89e8041a9b79bfbeb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad61478b9b8e7a80297fe38e960e1ae63" id="r_ad61478b9b8e7a80297fe38e960e1ae63"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d38/test__hot__path__helper_8cpp.html#ad61478b9b8e7a80297fe38e960e1ae63">TEST_F</a> (<a class="el" href="../../de/d76/classHotPathHelperTest.html">HotPathHelperTest</a>, HotPathOptimizationVerification)</td></tr>
<tr class="separator:ad61478b9b8e7a80297fe38e960e1ae63"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Unit tests for hot-path optimization helpers. </p>

<p class="definition">Definition in file <a class="el" href="../../d4/d38/test__hot__path__helper_8cpp_source.html">test_hot_path_helper.cpp</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a79be2172d6e9a1246721691a09cc23e7" name="a79be2172d6e9a1246721691a09cc23e7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a79be2172d6e9a1246721691a09cc23e7">&#9670;&#160;</a></span>TEST_F() <span class="overload">[1/11]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TEST_F </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../de/d76/classHotPathHelperTest.html">HotPathHelperTest</a>&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ConcurrentDifferentKeys&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/d38/test__hot__path__helper_8cpp_source.html#l00222">222</a> of file <a class="el" href="../../d4/d38/test__hot__path__helper_8cpp_source.html">test_hot_path_helper.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  222</span>                                                   {</div>
<div class="line"><span class="lineno">  223</span>    std::atomic&lt;int&gt; total_creates{0};</div>
<div class="line"><span class="lineno">  224</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> num_threads = 10;</div>
<div class="line"><span class="lineno">  225</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> keys_per_thread = 100;</div>
<div class="line"><span class="lineno">  226</span> </div>
<div class="line"><span class="lineno">  227</span>    std::vector&lt;std::thread&gt; threads;</div>
<div class="line"><span class="lineno">  228</span>    threads.reserve(num_threads);</div>
<div class="line"><span class="lineno">  229</span> </div>
<div class="line"><span class="lineno">  230</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> t = 0; t &lt; num_threads; ++t) {</div>
<div class="line"><span class="lineno">  231</span>        threads.emplace_back([<span class="keyword">this</span>, t, &amp;total_creates, keys_per_thread]() {</div>
<div class="line"><span class="lineno">  232</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; keys_per_thread; ++i) {</div>
<div class="line"><span class="lineno">  233</span>                std::string key = <span class="stringliteral">&quot;key_&quot;</span> + std::to_string(t) + <span class="stringliteral">&quot;_&quot;</span> + std::to_string(i);</div>
<div class="line"><span class="lineno">  234</span>                <span class="keyword">auto</span>* ptr = <a class="code hl_function" href="../../df/d67/namespacekcenon_1_1monitoring_1_1hot__path.html#ada0e55ad46d8d53e05317d5296ab4993">get_or_create</a>(</div>
<div class="line"><span class="lineno">  235</span>                    map_, mutex_, key,</div>
<div class="line"><span class="lineno">  236</span>                    [&amp;total_creates]() {</div>
<div class="line"><span class="lineno">  237</span>                        ++total_creates;</div>
<div class="line"><span class="lineno">  238</span>                        <span class="keywordflow">return</span> std::make_unique&lt;TestData&gt;();</div>
<div class="line"><span class="lineno">  239</span>                    });</div>
<div class="line"><span class="lineno">  240</span>                ASSERT_NE(ptr, <span class="keyword">nullptr</span>);</div>
<div class="line"><span class="lineno">  241</span>            }</div>
<div class="line"><span class="lineno">  242</span>        });</div>
<div class="line"><span class="lineno">  243</span>    }</div>
<div class="line"><span class="lineno">  244</span> </div>
<div class="line"><span class="lineno">  245</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; t : threads) {</div>
<div class="line"><span class="lineno">  246</span>        t.join();</div>
<div class="line"><span class="lineno">  247</span>    }</div>
<div class="line"><span class="lineno">  248</span> </div>
<div class="line"><span class="lineno">  249</span>    EXPECT_EQ(map_.size(), <span class="keyword">static_cast&lt;</span><span class="keywordtype">size_t</span><span class="keyword">&gt;</span>(num_threads * keys_per_thread));</div>
<div class="line"><span class="lineno">  250</span>    EXPECT_EQ(total_creates.load(), num_threads * keys_per_thread);</div>
<div class="line"><span class="lineno">  251</span>}</div>
<div class="ttc" id="anamespacekcenon_1_1monitoring_1_1hot__path_html_ada0e55ad46d8d53e05317d5296ab4993"><div class="ttname"><a href="../../df/d67/namespacekcenon_1_1monitoring_1_1hot__path.html#ada0e55ad46d8d53e05317d5296ab4993">kcenon::monitoring::hot_path::get_or_create</a></div><div class="ttdeci">auto get_or_create(Map &amp;map, std::shared_mutex &amp;mutex, const Key &amp;key, CreateFn create_fn) -&gt; typename std::remove_reference&lt; decltype(*map.begin() -&gt;second)&gt;::type *</div><div class="ttdef"><b>Definition</b> <a href="../../d2/de0/hot__path__helper_8h_source.html#l00094">hot_path_helper.h:94</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d4/d38/test__hot__path__helper_8cpp_a79be2172d6e9a1246721691a09cc23e7_cgraph.png" border="0" usemap="#ad4/d38/test__hot__path__helper_8cpp_a79be2172d6e9a1246721691a09cc23e7_cgraph" alt=""/></div>
<map name="ad4/d38/test__hot__path__helper_8cpp_a79be2172d6e9a1246721691a09cc23e7_cgraph" id="ad4/d38/test__hot__path__helper_8cpp_a79be2172d6e9a1246721691a09cc23e7_cgraph">
<area shape="rect" title=" " alt="" coords="5,13,75,38"/>
<area shape="rect" href="../../df/d67/namespacekcenon_1_1monitoring_1_1hot__path.html#ada0e55ad46d8d53e05317d5296ab4993" title=" " alt="" coords="123,5,307,45"/>
<area shape="poly" title=" " alt="" coords="75,23,109,23,109,28,75,28"/>
</map>
</div>

</div>
</div>
<a id="ac327b84053ff57cb897b2b80f6fd3104" name="ac327b84053ff57cb897b2b80f6fd3104"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac327b84053ff57cb897b2b80f6fd3104">&#9670;&#160;</a></span>TEST_F() <span class="overload">[2/11]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TEST_F </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../de/d76/classHotPathHelperTest.html">HotPathHelperTest</a>&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ConcurrentGetOrCreate&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/d38/test__hot__path__helper_8cpp_source.html#l00192">192</a> of file <a class="el" href="../../d4/d38/test__hot__path__helper_8cpp_source.html">test_hot_path_helper.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  192</span>                                                 {</div>
<div class="line"><span class="lineno">  193</span>    std::atomic&lt;int&gt; create_count{0};</div>
<div class="line"><span class="lineno">  194</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> num_threads = 10;</div>
<div class="line"><span class="lineno">  195</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> iterations_per_thread = 1000;</div>
<div class="line"><span class="lineno">  196</span> </div>
<div class="line"><span class="lineno">  197</span>    std::vector&lt;std::thread&gt; threads;</div>
<div class="line"><span class="lineno">  198</span>    threads.reserve(num_threads);</div>
<div class="line"><span class="lineno">  199</span> </div>
<div class="line"><span class="lineno">  200</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> t = 0; t &lt; num_threads; ++t) {</div>
<div class="line"><span class="lineno">  201</span>        threads.emplace_back([<span class="keyword">this</span>, &amp;create_count, iterations_per_thread]() {</div>
<div class="line"><span class="lineno">  202</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; iterations_per_thread; ++i) {</div>
<div class="line"><span class="lineno">  203</span>                <span class="keyword">auto</span>* ptr = <a class="code hl_function" href="../../df/d67/namespacekcenon_1_1monitoring_1_1hot__path.html#ada0e55ad46d8d53e05317d5296ab4993">get_or_create</a>(</div>
<div class="line"><span class="lineno">  204</span>                    map_, mutex_, <span class="stringliteral">&quot;shared_key&quot;</span>,</div>
<div class="line"><span class="lineno">  205</span>                    [&amp;create_count]() {</div>
<div class="line"><span class="lineno">  206</span>                        ++create_count;</div>
<div class="line"><span class="lineno">  207</span>                        <span class="keywordflow">return</span> std::make_unique&lt;TestData&gt;();</div>
<div class="line"><span class="lineno">  208</span>                    });</div>
<div class="line"><span class="lineno">  209</span>                ASSERT_NE(ptr, <span class="keyword">nullptr</span>);</div>
<div class="line"><span class="lineno">  210</span>            }</div>
<div class="line"><span class="lineno">  211</span>        });</div>
<div class="line"><span class="lineno">  212</span>    }</div>
<div class="line"><span class="lineno">  213</span> </div>
<div class="line"><span class="lineno">  214</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; t : threads) {</div>
<div class="line"><span class="lineno">  215</span>        t.join();</div>
<div class="line"><span class="lineno">  216</span>    }</div>
<div class="line"><span class="lineno">  217</span> </div>
<div class="line"><span class="lineno">  218</span>    EXPECT_EQ(map_.size(), 1u);</div>
<div class="line"><span class="lineno">  219</span>    EXPECT_EQ(create_count.load(), 1);  <span class="comment">// Only one creation should occur</span></div>
<div class="line"><span class="lineno">  220</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d4/d38/test__hot__path__helper_8cpp_ac327b84053ff57cb897b2b80f6fd3104_cgraph.png" border="0" usemap="#ad4/d38/test__hot__path__helper_8cpp_ac327b84053ff57cb897b2b80f6fd3104_cgraph" alt=""/></div>
<map name="ad4/d38/test__hot__path__helper_8cpp_ac327b84053ff57cb897b2b80f6fd3104_cgraph" id="ad4/d38/test__hot__path__helper_8cpp_ac327b84053ff57cb897b2b80f6fd3104_cgraph">
<area shape="rect" title=" " alt="" coords="5,13,75,38"/>
<area shape="rect" href="../../df/d67/namespacekcenon_1_1monitoring_1_1hot__path.html#ada0e55ad46d8d53e05317d5296ab4993" title=" " alt="" coords="123,5,307,45"/>
<area shape="poly" title=" " alt="" coords="75,23,109,23,109,28,75,28"/>
</map>
</div>

</div>
</div>
<a id="a58571a0ac5f0ebf89e8041a9b79bfbeb" name="a58571a0ac5f0ebf89e8041a9b79bfbeb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a58571a0ac5f0ebf89e8041a9b79bfbeb">&#9670;&#160;</a></span>TEST_F() <span class="overload">[3/11]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TEST_F </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../de/d76/classHotPathHelperTest.html">HotPathHelperTest</a>&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ConcurrentMixedReadWrite&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/d38/test__hot__path__helper_8cpp_source.html#l00253">253</a> of file <a class="el" href="../../d4/d38/test__hot__path__helper_8cpp_source.html">test_hot_path_helper.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  253</span>                                                    {</div>
<div class="line"><span class="lineno">  254</span>    <span class="comment">// Pre-create some entries</span></div>
<div class="line"><span class="lineno">  255</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 50; ++i) {</div>
<div class="line"><span class="lineno">  256</span>        map_[<span class="stringliteral">&quot;existing_&quot;</span> + std::to_string(i)] = std::make_unique&lt;TestData&gt;();</div>
<div class="line"><span class="lineno">  257</span>    }</div>
<div class="line"><span class="lineno">  258</span> </div>
<div class="line"><span class="lineno">  259</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> num_threads = 8;</div>
<div class="line"><span class="lineno">  260</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> iterations = 500;</div>
<div class="line"><span class="lineno">  261</span> </div>
<div class="line"><span class="lineno">  262</span>    std::vector&lt;std::thread&gt; threads;</div>
<div class="line"><span class="lineno">  263</span>    threads.reserve(num_threads);</div>
<div class="line"><span class="lineno">  264</span> </div>
<div class="line"><span class="lineno">  265</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> t = 0; t &lt; num_threads; ++t) {</div>
<div class="line"><span class="lineno">  266</span>        threads.emplace_back([<span class="keyword">this</span>, t, iterations]() {</div>
<div class="line"><span class="lineno">  267</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; iterations; ++i) {</div>
<div class="line"><span class="lineno">  268</span>                <span class="comment">// Half the time access existing, half the time create new</span></div>
<div class="line"><span class="lineno">  269</span>                std::string key = (i % 2 == 0)</div>
<div class="line"><span class="lineno">  270</span>                    ? <span class="stringliteral">&quot;existing_&quot;</span> + std::to_string(i % 50)</div>
<div class="line"><span class="lineno">  271</span>                    : <span class="stringliteral">&quot;new_&quot;</span> + std::to_string(t) + <span class="stringliteral">&quot;_&quot;</span> + std::to_string(i);</div>
<div class="line"><span class="lineno">  272</span> </div>
<div class="line"><span class="lineno">  273</span>                <span class="keyword">auto</span>* ptr = <a class="code hl_function" href="../../df/d67/namespacekcenon_1_1monitoring_1_1hot__path.html#ada0e55ad46d8d53e05317d5296ab4993">get_or_create</a>(</div>
<div class="line"><span class="lineno">  274</span>                    map_, mutex_, key,</div>
<div class="line"><span class="lineno">  275</span>                    []() { <span class="keywordflow">return</span> std::make_unique&lt;TestData&gt;(); });</div>
<div class="line"><span class="lineno">  276</span>                ASSERT_NE(ptr, <span class="keyword">nullptr</span>);</div>
<div class="line"><span class="lineno">  277</span>            }</div>
<div class="line"><span class="lineno">  278</span>        });</div>
<div class="line"><span class="lineno">  279</span>    }</div>
<div class="line"><span class="lineno">  280</span> </div>
<div class="line"><span class="lineno">  281</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; t : threads) {</div>
<div class="line"><span class="lineno">  282</span>        t.join();</div>
<div class="line"><span class="lineno">  283</span>    }</div>
<div class="line"><span class="lineno">  284</span> </div>
<div class="line"><span class="lineno">  285</span>    EXPECT_GE(map_.size(), 50u);  <span class="comment">// At least the pre-existing entries</span></div>
<div class="line"><span class="lineno">  286</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d4/d38/test__hot__path__helper_8cpp_a58571a0ac5f0ebf89e8041a9b79bfbeb_cgraph.png" border="0" usemap="#ad4/d38/test__hot__path__helper_8cpp_a58571a0ac5f0ebf89e8041a9b79bfbeb_cgraph" alt=""/></div>
<map name="ad4/d38/test__hot__path__helper_8cpp_a58571a0ac5f0ebf89e8041a9b79bfbeb_cgraph" id="ad4/d38/test__hot__path__helper_8cpp_a58571a0ac5f0ebf89e8041a9b79bfbeb_cgraph">
<area shape="rect" title=" " alt="" coords="5,13,75,38"/>
<area shape="rect" href="../../df/d67/namespacekcenon_1_1monitoring_1_1hot__path.html#ada0e55ad46d8d53e05317d5296ab4993" title=" " alt="" coords="123,5,307,45"/>
<area shape="poly" title=" " alt="" coords="75,23,109,23,109,28,75,28"/>
</map>
</div>

</div>
</div>
<a id="ad052b7b4dc32eae0b04fb368174c2415" name="ad052b7b4dc32eae0b04fb368174c2415"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad052b7b4dc32eae0b04fb368174c2415">&#9670;&#160;</a></span>TEST_F() <span class="overload">[4/11]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TEST_F </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../de/d76/classHotPathHelperTest.html">HotPathHelperTest</a>&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GetOrCreateAndUpdateExistingEntry&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/d38/test__hot__path__helper_8cpp_source.html#l00171">171</a> of file <a class="el" href="../../d4/d38/test__hot__path__helper_8cpp_source.html">test_hot_path_helper.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  171</span>                                                             {</div>
<div class="line"><span class="lineno">  172</span>    <span class="comment">// Pre-create an entry</span></div>
<div class="line"><span class="lineno">  173</span>    map_[<span class="stringliteral">&quot;key1&quot;</span>] = std::make_unique&lt;TestData&gt;();</div>
<div class="line"><span class="lineno">  174</span>    map_[<span class="stringliteral">&quot;key1&quot;</span>]-&gt;value = 10;</div>
<div class="line"><span class="lineno">  175</span> </div>
<div class="line"><span class="lineno">  176</span>    <span class="keywordtype">int</span> result = <a class="code hl_function" href="../../df/d67/namespacekcenon_1_1monitoring_1_1hot__path.html#a7157360888ddb2753b07f2b747404e08">get_or_create_and_update</a>(</div>
<div class="line"><span class="lineno">  177</span>        map_, mutex_, <span class="stringliteral">&quot;key1&quot;</span>,</div>
<div class="line"><span class="lineno">  178</span>        []() { <span class="keywordflow">return</span> std::make_unique&lt;TestData&gt;(); },</div>
<div class="line"><span class="lineno">  179</span>        [](TestData&amp; d) {</div>
<div class="line"><span class="lineno">  180</span>            d.value += 5;</div>
<div class="line"><span class="lineno">  181</span>            <span class="keywordflow">return</span> d.value;</div>
<div class="line"><span class="lineno">  182</span>        });</div>
<div class="line"><span class="lineno">  183</span> </div>
<div class="line"><span class="lineno">  184</span>    EXPECT_EQ(result, 15);</div>
<div class="line"><span class="lineno">  185</span>    EXPECT_EQ(map_[<span class="stringliteral">&quot;key1&quot;</span>]-&gt;value, 15);</div>
<div class="line"><span class="lineno">  186</span>}</div>
<div class="ttc" id="anamespacekcenon_1_1monitoring_1_1hot__path_html_a7157360888ddb2753b07f2b747404e08"><div class="ttname"><a href="../../df/d67/namespacekcenon_1_1monitoring_1_1hot__path.html#a7157360888ddb2753b07f2b747404e08">kcenon::monitoring::hot_path::get_or_create_and_update</a></div><div class="ttdeci">auto get_or_create_and_update(Map &amp;map, std::shared_mutex &amp;mutex, const Key &amp;key, CreateFn create_fn, UpdateFn update_fn) -&gt; decltype(update_fn(*map.begin() -&gt;second))</div><div class="ttdef"><b>Definition</b> <a href="../../d2/de0/hot__path__helper_8h_source.html#l00229">hot_path_helper.h:229</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d4/d38/test__hot__path__helper_8cpp_ad052b7b4dc32eae0b04fb368174c2415_cgraph.png" border="0" usemap="#ad4/d38/test__hot__path__helper_8cpp_ad052b7b4dc32eae0b04fb368174c2415_cgraph" alt=""/></div>
<map name="ad4/d38/test__hot__path__helper_8cpp_ad052b7b4dc32eae0b04fb368174c2415_cgraph" id="ad4/d38/test__hot__path__helper_8cpp_ad052b7b4dc32eae0b04fb368174c2415_cgraph">
<area shape="rect" title=" " alt="" coords="5,20,75,45"/>
<area shape="rect" href="../../df/d67/namespacekcenon_1_1monitoring_1_1hot__path.html#a7157360888ddb2753b07f2b747404e08" title=" " alt="" coords="123,5,307,60"/>
<area shape="poly" title=" " alt="" coords="75,30,109,30,109,35,75,35"/>
<area shape="rect" href="../../df/d67/namespacekcenon_1_1monitoring_1_1hot__path.html#ada0e55ad46d8d53e05317d5296ab4993" title=" " alt="" coords="355,13,539,53"/>
<area shape="poly" title=" " alt="" coords="307,30,341,30,341,35,307,35"/>
</map>
</div>

</div>
</div>
<a id="ad8aa72525bcd43b0e59f76a73cbb112c" name="ad8aa72525bcd43b0e59f76a73cbb112c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad8aa72525bcd43b0e59f76a73cbb112c">&#9670;&#160;</a></span>TEST_F() <span class="overload">[5/11]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TEST_F </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../de/d76/classHotPathHelperTest.html">HotPathHelperTest</a>&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GetOrCreateAndUpdateNewEntry&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/d38/test__hot__path__helper_8cpp_source.html#l00158">158</a> of file <a class="el" href="../../d4/d38/test__hot__path__helper_8cpp_source.html">test_hot_path_helper.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  158</span>                                                        {</div>
<div class="line"><span class="lineno">  159</span>    <span class="keywordtype">int</span> result = <a class="code hl_function" href="../../df/d67/namespacekcenon_1_1monitoring_1_1hot__path.html#a7157360888ddb2753b07f2b747404e08">get_or_create_and_update</a>(</div>
<div class="line"><span class="lineno">  160</span>        map_, mutex_, <span class="stringliteral">&quot;key1&quot;</span>,</div>
<div class="line"><span class="lineno">  161</span>        []() { <span class="keywordflow">return</span> std::make_unique&lt;TestData&gt;(); },</div>
<div class="line"><span class="lineno">  162</span>        [](TestData&amp; d) {</div>
<div class="line"><span class="lineno">  163</span>            d.value = 42;</div>
<div class="line"><span class="lineno">  164</span>            <span class="keywordflow">return</span> d.value;</div>
<div class="line"><span class="lineno">  165</span>        });</div>
<div class="line"><span class="lineno">  166</span> </div>
<div class="line"><span class="lineno">  167</span>    EXPECT_EQ(result, 42);</div>
<div class="line"><span class="lineno">  168</span>    EXPECT_EQ(map_[<span class="stringliteral">&quot;key1&quot;</span>]-&gt;value, 42);</div>
<div class="line"><span class="lineno">  169</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d4/d38/test__hot__path__helper_8cpp_ad8aa72525bcd43b0e59f76a73cbb112c_cgraph.png" border="0" usemap="#ad4/d38/test__hot__path__helper_8cpp_ad8aa72525bcd43b0e59f76a73cbb112c_cgraph" alt=""/></div>
<map name="ad4/d38/test__hot__path__helper_8cpp_ad8aa72525bcd43b0e59f76a73cbb112c_cgraph" id="ad4/d38/test__hot__path__helper_8cpp_ad8aa72525bcd43b0e59f76a73cbb112c_cgraph">
<area shape="rect" title=" " alt="" coords="5,20,75,45"/>
<area shape="rect" href="../../df/d67/namespacekcenon_1_1monitoring_1_1hot__path.html#a7157360888ddb2753b07f2b747404e08" title=" " alt="" coords="123,5,307,60"/>
<area shape="poly" title=" " alt="" coords="75,30,109,30,109,35,75,35"/>
<area shape="rect" href="../../df/d67/namespacekcenon_1_1monitoring_1_1hot__path.html#ada0e55ad46d8d53e05317d5296ab4993" title=" " alt="" coords="355,13,539,53"/>
<area shape="poly" title=" " alt="" coords="307,30,341,30,341,35,307,35"/>
</map>
</div>

</div>
</div>
<a id="a9088ee1dc8186e725e0e0ccc7dcb7de6" name="a9088ee1dc8186e725e0e0ccc7dcb7de6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9088ee1dc8186e725e0e0ccc7dcb7de6">&#9670;&#160;</a></span>TEST_F() <span class="overload">[6/11]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TEST_F </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../de/d76/classHotPathHelperTest.html">HotPathHelperTest</a>&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GetOrCreateExistingEntry&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/d38/test__hot__path__helper_8cpp_source.html#l00082">82</a> of file <a class="el" href="../../d4/d38/test__hot__path__helper_8cpp_source.html">test_hot_path_helper.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   82</span>                                                    {</div>
<div class="line"><span class="lineno">   83</span>    <span class="comment">// Pre-create an entry</span></div>
<div class="line"><span class="lineno">   84</span>    map_[<span class="stringliteral">&quot;key1&quot;</span>] = std::make_unique&lt;TestData&gt;();</div>
<div class="line"><span class="lineno">   85</span>    map_[<span class="stringliteral">&quot;key1&quot;</span>]-&gt;value = 42;</div>
<div class="line"><span class="lineno">   86</span> </div>
<div class="line"><span class="lineno">   87</span>    <span class="keywordtype">int</span> create_count = 0;</div>
<div class="line"><span class="lineno">   88</span>    <span class="keyword">auto</span>* ptr = <a class="code hl_function" href="../../df/d67/namespacekcenon_1_1monitoring_1_1hot__path.html#ada0e55ad46d8d53e05317d5296ab4993">get_or_create</a>(</div>
<div class="line"><span class="lineno">   89</span>        map_, mutex_, <span class="stringliteral">&quot;key1&quot;</span>,</div>
<div class="line"><span class="lineno">   90</span>        [&amp;create_count]() {</div>
<div class="line"><span class="lineno">   91</span>            ++create_count;</div>
<div class="line"><span class="lineno">   92</span>            <span class="keywordflow">return</span> std::make_unique&lt;TestData&gt;();</div>
<div class="line"><span class="lineno">   93</span>        });</div>
<div class="line"><span class="lineno">   94</span> </div>
<div class="line"><span class="lineno">   95</span>    ASSERT_NE(ptr, <span class="keyword">nullptr</span>);</div>
<div class="line"><span class="lineno">   96</span>    EXPECT_EQ(map_.size(), 1u);</div>
<div class="line"><span class="lineno">   97</span>    EXPECT_EQ(ptr-&gt;value, 42);</div>
<div class="line"><span class="lineno">   98</span>    EXPECT_EQ(create_count, 0);  <span class="comment">// Factory should not be called</span></div>
<div class="line"><span class="lineno">   99</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d4/d38/test__hot__path__helper_8cpp_a9088ee1dc8186e725e0e0ccc7dcb7de6_cgraph.png" border="0" usemap="#ad4/d38/test__hot__path__helper_8cpp_a9088ee1dc8186e725e0e0ccc7dcb7de6_cgraph" alt=""/></div>
<map name="ad4/d38/test__hot__path__helper_8cpp_a9088ee1dc8186e725e0e0ccc7dcb7de6_cgraph" id="ad4/d38/test__hot__path__helper_8cpp_a9088ee1dc8186e725e0e0ccc7dcb7de6_cgraph">
<area shape="rect" title=" " alt="" coords="5,13,75,38"/>
<area shape="rect" href="../../df/d67/namespacekcenon_1_1monitoring_1_1hot__path.html#ada0e55ad46d8d53e05317d5296ab4993" title=" " alt="" coords="123,5,307,45"/>
<area shape="poly" title=" " alt="" coords="75,23,109,23,109,28,75,28"/>
</map>
</div>

</div>
</div>
<a id="a9605b99a2b4f6748fcfaf09829f14150" name="a9605b99a2b4f6748fcfaf09829f14150"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9605b99a2b4f6748fcfaf09829f14150">&#9670;&#160;</a></span>TEST_F() <span class="overload">[7/11]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TEST_F </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../de/d76/classHotPathHelperTest.html">HotPathHelperTest</a>&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GetOrCreateMultipleKeys&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/d38/test__hot__path__helper_8cpp_source.html#l00101">101</a> of file <a class="el" href="../../d4/d38/test__hot__path__helper_8cpp_source.html">test_hot_path_helper.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  101</span>                                                   {</div>
<div class="line"><span class="lineno">  102</span>    <span class="keyword">auto</span>* ptr1 = <a class="code hl_function" href="../../df/d67/namespacekcenon_1_1monitoring_1_1hot__path.html#ada0e55ad46d8d53e05317d5296ab4993">get_or_create</a>(</div>
<div class="line"><span class="lineno">  103</span>        map_, mutex_, <span class="stringliteral">&quot;key1&quot;</span>,</div>
<div class="line"><span class="lineno">  104</span>        []() { <span class="keywordflow">return</span> std::make_unique&lt;TestData&gt;(); });</div>
<div class="line"><span class="lineno">  105</span>    <span class="keyword">auto</span>* ptr2 = <a class="code hl_function" href="../../df/d67/namespacekcenon_1_1monitoring_1_1hot__path.html#ada0e55ad46d8d53e05317d5296ab4993">get_or_create</a>(</div>
<div class="line"><span class="lineno">  106</span>        map_, mutex_, <span class="stringliteral">&quot;key2&quot;</span>,</div>
<div class="line"><span class="lineno">  107</span>        []() { <span class="keywordflow">return</span> std::make_unique&lt;TestData&gt;(); });</div>
<div class="line"><span class="lineno">  108</span> </div>
<div class="line"><span class="lineno">  109</span>    ASSERT_NE(ptr1, <span class="keyword">nullptr</span>);</div>
<div class="line"><span class="lineno">  110</span>    ASSERT_NE(ptr2, <span class="keyword">nullptr</span>);</div>
<div class="line"><span class="lineno">  111</span>    EXPECT_NE(ptr1, ptr2);</div>
<div class="line"><span class="lineno">  112</span>    EXPECT_EQ(map_.size(), 2u);</div>
<div class="line"><span class="lineno">  113</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d4/d38/test__hot__path__helper_8cpp_a9605b99a2b4f6748fcfaf09829f14150_cgraph.png" border="0" usemap="#ad4/d38/test__hot__path__helper_8cpp_a9605b99a2b4f6748fcfaf09829f14150_cgraph" alt=""/></div>
<map name="ad4/d38/test__hot__path__helper_8cpp_a9605b99a2b4f6748fcfaf09829f14150_cgraph" id="ad4/d38/test__hot__path__helper_8cpp_a9605b99a2b4f6748fcfaf09829f14150_cgraph">
<area shape="rect" title=" " alt="" coords="5,13,75,38"/>
<area shape="rect" href="../../df/d67/namespacekcenon_1_1monitoring_1_1hot__path.html#ada0e55ad46d8d53e05317d5296ab4993" title=" " alt="" coords="123,5,307,45"/>
<area shape="poly" title=" " alt="" coords="75,23,109,23,109,28,75,28"/>
</map>
</div>

</div>
</div>
<a id="ad740efc2ee33f79991c2491efa2035d3" name="ad740efc2ee33f79991c2491efa2035d3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad740efc2ee33f79991c2491efa2035d3">&#9670;&#160;</a></span>TEST_F() <span class="overload">[8/11]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TEST_F </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../de/d76/classHotPathHelperTest.html">HotPathHelperTest</a>&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GetOrCreateNewEntry&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/d38/test__hot__path__helper_8cpp_source.html#l00072">72</a> of file <a class="el" href="../../d4/d38/test__hot__path__helper_8cpp_source.html">test_hot_path_helper.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   72</span>                                               {</div>
<div class="line"><span class="lineno">   73</span>    <span class="keyword">auto</span>* ptr = <a class="code hl_function" href="../../df/d67/namespacekcenon_1_1monitoring_1_1hot__path.html#ada0e55ad46d8d53e05317d5296ab4993">get_or_create</a>(</div>
<div class="line"><span class="lineno">   74</span>        map_, mutex_, <span class="stringliteral">&quot;key1&quot;</span>,</div>
<div class="line"><span class="lineno">   75</span>        []() { <span class="keywordflow">return</span> std::make_unique&lt;TestData&gt;(); });</div>
<div class="line"><span class="lineno">   76</span> </div>
<div class="line"><span class="lineno">   77</span>    ASSERT_NE(ptr, <span class="keyword">nullptr</span>);</div>
<div class="line"><span class="lineno">   78</span>    EXPECT_EQ(map_.size(), 1u);</div>
<div class="line"><span class="lineno">   79</span>    EXPECT_EQ(ptr-&gt;value, 0);</div>
<div class="line"><span class="lineno">   80</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d4/d38/test__hot__path__helper_8cpp_ad740efc2ee33f79991c2491efa2035d3_cgraph.png" border="0" usemap="#ad4/d38/test__hot__path__helper_8cpp_ad740efc2ee33f79991c2491efa2035d3_cgraph" alt=""/></div>
<map name="ad4/d38/test__hot__path__helper_8cpp_ad740efc2ee33f79991c2491efa2035d3_cgraph" id="ad4/d38/test__hot__path__helper_8cpp_ad740efc2ee33f79991c2491efa2035d3_cgraph">
<area shape="rect" title=" " alt="" coords="5,13,75,38"/>
<area shape="rect" href="../../df/d67/namespacekcenon_1_1monitoring_1_1hot__path.html#ada0e55ad46d8d53e05317d5296ab4993" title=" " alt="" coords="123,5,307,45"/>
<area shape="poly" title=" " alt="" coords="75,23,109,23,109,28,75,28"/>
</map>
</div>

</div>
</div>
<a id="aa9f263e7c0939fc35bc877d33e2876f8" name="aa9f263e7c0939fc35bc877d33e2876f8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa9f263e7c0939fc35bc877d33e2876f8">&#9670;&#160;</a></span>TEST_F() <span class="overload">[9/11]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TEST_F </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../de/d76/classHotPathHelperTest.html">HotPathHelperTest</a>&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GetOrCreateWithInitExistingEntry&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/d38/test__hot__path__helper_8cpp_source.html#l00133">133</a> of file <a class="el" href="../../d4/d38/test__hot__path__helper_8cpp_source.html">test_hot_path_helper.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  133</span>                                                            {</div>
<div class="line"><span class="lineno">  134</span>    <span class="comment">// Pre-create an entry</span></div>
<div class="line"><span class="lineno">  135</span>    map_[<span class="stringliteral">&quot;key1&quot;</span>] = std::make_unique&lt;TestData&gt;();</div>
<div class="line"><span class="lineno">  136</span>    map_[<span class="stringliteral">&quot;key1&quot;</span>]-&gt;value = 42;</div>
<div class="line"><span class="lineno">  137</span>    map_[<span class="stringliteral">&quot;key1&quot;</span>]-&gt;name = <span class="stringliteral">&quot;original&quot;</span>;</div>
<div class="line"><span class="lineno">  138</span> </div>
<div class="line"><span class="lineno">  139</span>    <span class="keywordtype">int</span> init_count = 0;</div>
<div class="line"><span class="lineno">  140</span>    <span class="keyword">auto</span>* ptr = <a class="code hl_function" href="../../df/d67/namespacekcenon_1_1monitoring_1_1hot__path.html#a23d936d26c12a0c5392976b822e55c15">get_or_create_with_init</a>(</div>
<div class="line"><span class="lineno">  141</span>        map_, mutex_, <span class="stringliteral">&quot;key1&quot;</span>,</div>
<div class="line"><span class="lineno">  142</span>        []() { <span class="keywordflow">return</span> std::make_unique&lt;TestData&gt;(); },</div>
<div class="line"><span class="lineno">  143</span>        [&amp;init_count](TestData&amp; d) {</div>
<div class="line"><span class="lineno">  144</span>            ++init_count;</div>
<div class="line"><span class="lineno">  145</span>            d.value = 100;</div>
<div class="line"><span class="lineno">  146</span>        });</div>
<div class="line"><span class="lineno">  147</span> </div>
<div class="line"><span class="lineno">  148</span>    ASSERT_NE(ptr, <span class="keyword">nullptr</span>);</div>
<div class="line"><span class="lineno">  149</span>    EXPECT_EQ(ptr-&gt;value, 42);  <span class="comment">// Should not be modified</span></div>
<div class="line"><span class="lineno">  150</span>    EXPECT_EQ(ptr-&gt;name, <span class="stringliteral">&quot;original&quot;</span>);</div>
<div class="line"><span class="lineno">  151</span>    EXPECT_EQ(init_count, 0);  <span class="comment">// Init should not be called</span></div>
<div class="line"><span class="lineno">  152</span>}</div>
<div class="ttc" id="anamespacekcenon_1_1monitoring_1_1hot__path_html_a23d936d26c12a0c5392976b822e55c15"><div class="ttname"><a href="../../df/d67/namespacekcenon_1_1monitoring_1_1hot__path.html#a23d936d26c12a0c5392976b822e55c15">kcenon::monitoring::hot_path::get_or_create_with_init</a></div><div class="ttdeci">auto get_or_create_with_init(Map &amp;map, std::shared_mutex &amp;mutex, const Key &amp;key, CreateFn create_fn, InitFn init_fn) -&gt; typename std::remove_reference&lt; decltype(*map.begin() -&gt;second)&gt;::type *</div><div class="ttdef"><b>Definition</b> <a href="../../d2/de0/hot__path__helper_8h_source.html#l00160">hot_path_helper.h:160</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d4/d38/test__hot__path__helper_8cpp_aa9f263e7c0939fc35bc877d33e2876f8_cgraph.png" border="0" usemap="#ad4/d38/test__hot__path__helper_8cpp_aa9f263e7c0939fc35bc877d33e2876f8_cgraph" alt=""/></div>
<map name="ad4/d38/test__hot__path__helper_8cpp_aa9f263e7c0939fc35bc877d33e2876f8_cgraph" id="ad4/d38/test__hot__path__helper_8cpp_aa9f263e7c0939fc35bc877d33e2876f8_cgraph">
<area shape="rect" title=" " alt="" coords="5,20,75,45"/>
<area shape="rect" href="../../df/d67/namespacekcenon_1_1monitoring_1_1hot__path.html#a23d936d26c12a0c5392976b822e55c15" title=" " alt="" coords="123,5,307,60"/>
<area shape="poly" title=" " alt="" coords="75,30,109,30,109,35,75,35"/>
</map>
</div>

</div>
</div>
<a id="a391e73dc7d0f9619ff60cb78c89a0bac" name="a391e73dc7d0f9619ff60cb78c89a0bac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a391e73dc7d0f9619ff60cb78c89a0bac">&#9670;&#160;</a></span>TEST_F() <span class="overload">[10/11]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TEST_F </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../de/d76/classHotPathHelperTest.html">HotPathHelperTest</a>&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GetOrCreateWithInitNewEntry&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/d38/test__hot__path__helper_8cpp_source.html#l00119">119</a> of file <a class="el" href="../../d4/d38/test__hot__path__helper_8cpp_source.html">test_hot_path_helper.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  119</span>                                                       {</div>
<div class="line"><span class="lineno">  120</span>    <span class="keyword">auto</span>* ptr = <a class="code hl_function" href="../../df/d67/namespacekcenon_1_1monitoring_1_1hot__path.html#a23d936d26c12a0c5392976b822e55c15">get_or_create_with_init</a>(</div>
<div class="line"><span class="lineno">  121</span>        map_, mutex_, <span class="stringliteral">&quot;key1&quot;</span>,</div>
<div class="line"><span class="lineno">  122</span>        []() { <span class="keywordflow">return</span> std::make_unique&lt;TestData&gt;(); },</div>
<div class="line"><span class="lineno">  123</span>        [](TestData&amp; d) {</div>
<div class="line"><span class="lineno">  124</span>            d.value = 100;</div>
<div class="line"><span class="lineno">  125</span>            d.name = <span class="stringliteral">&quot;initialized&quot;</span>;</div>
<div class="line"><span class="lineno">  126</span>        });</div>
<div class="line"><span class="lineno">  127</span> </div>
<div class="line"><span class="lineno">  128</span>    ASSERT_NE(ptr, <span class="keyword">nullptr</span>);</div>
<div class="line"><span class="lineno">  129</span>    EXPECT_EQ(ptr-&gt;value, 100);</div>
<div class="line"><span class="lineno">  130</span>    EXPECT_EQ(ptr-&gt;name, <span class="stringliteral">&quot;initialized&quot;</span>);</div>
<div class="line"><span class="lineno">  131</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d4/d38/test__hot__path__helper_8cpp_a391e73dc7d0f9619ff60cb78c89a0bac_cgraph.png" border="0" usemap="#ad4/d38/test__hot__path__helper_8cpp_a391e73dc7d0f9619ff60cb78c89a0bac_cgraph" alt=""/></div>
<map name="ad4/d38/test__hot__path__helper_8cpp_a391e73dc7d0f9619ff60cb78c89a0bac_cgraph" id="ad4/d38/test__hot__path__helper_8cpp_a391e73dc7d0f9619ff60cb78c89a0bac_cgraph">
<area shape="rect" title=" " alt="" coords="5,20,75,45"/>
<area shape="rect" href="../../df/d67/namespacekcenon_1_1monitoring_1_1hot__path.html#a23d936d26c12a0c5392976b822e55c15" title=" " alt="" coords="123,5,307,60"/>
<area shape="poly" title=" " alt="" coords="75,30,109,30,109,35,75,35"/>
</map>
</div>

</div>
</div>
<a id="ad61478b9b8e7a80297fe38e960e1ae63" name="ad61478b9b8e7a80297fe38e960e1ae63"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad61478b9b8e7a80297fe38e960e1ae63">&#9670;&#160;</a></span>TEST_F() <span class="overload">[11/11]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TEST_F </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../de/d76/classHotPathHelperTest.html">HotPathHelperTest</a>&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">HotPathOptimizationVerification&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/d38/test__hot__path__helper_8cpp_source.html#l00292">292</a> of file <a class="el" href="../../d4/d38/test__hot__path__helper_8cpp_source.html">test_hot_path_helper.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  292</span>                                                           {</div>
<div class="line"><span class="lineno">  293</span>    <span class="comment">// Create entry first</span></div>
<div class="line"><span class="lineno">  294</span>    map_[<span class="stringliteral">&quot;hot_key&quot;</span>] = std::make_unique&lt;TestData&gt;();</div>
<div class="line"><span class="lineno">  295</span> </div>
<div class="line"><span class="lineno">  296</span>    std::atomic&lt;int&gt; create_calls{0};</div>
<div class="line"><span class="lineno">  297</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> hot_path_iterations = 10000;</div>
<div class="line"><span class="lineno">  298</span> </div>
<div class="line"><span class="lineno">  299</span>    <span class="comment">// Simulate hot path - many reads, no creates</span></div>
<div class="line"><span class="lineno">  300</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; hot_path_iterations; ++i) {</div>
<div class="line"><span class="lineno">  301</span>        <span class="keyword">auto</span>* ptr = <a class="code hl_function" href="../../df/d67/namespacekcenon_1_1monitoring_1_1hot__path.html#ada0e55ad46d8d53e05317d5296ab4993">get_or_create</a>(</div>
<div class="line"><span class="lineno">  302</span>            map_, mutex_, <span class="stringliteral">&quot;hot_key&quot;</span>,</div>
<div class="line"><span class="lineno">  303</span>            [&amp;create_calls]() {</div>
<div class="line"><span class="lineno">  304</span>                ++create_calls;</div>
<div class="line"><span class="lineno">  305</span>                <span class="keywordflow">return</span> std::make_unique&lt;TestData&gt;();</div>
<div class="line"><span class="lineno">  306</span>            });</div>
<div class="line"><span class="lineno">  307</span>        ASSERT_NE(ptr, <span class="keyword">nullptr</span>);</div>
<div class="line"><span class="lineno">  308</span>    }</div>
<div class="line"><span class="lineno">  309</span> </div>
<div class="line"><span class="lineno">  310</span>    <span class="comment">// Verify factory was never called (hot path optimization working)</span></div>
<div class="line"><span class="lineno">  311</span>    EXPECT_EQ(create_calls.load(), 0);</div>
<div class="line"><span class="lineno">  312</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d4/d38/test__hot__path__helper_8cpp_ad61478b9b8e7a80297fe38e960e1ae63_cgraph.png" border="0" usemap="#ad4/d38/test__hot__path__helper_8cpp_ad61478b9b8e7a80297fe38e960e1ae63_cgraph" alt=""/></div>
<map name="ad4/d38/test__hot__path__helper_8cpp_ad61478b9b8e7a80297fe38e960e1ae63_cgraph" id="ad4/d38/test__hot__path__helper_8cpp_ad61478b9b8e7a80297fe38e960e1ae63_cgraph">
<area shape="rect" title=" " alt="" coords="5,13,75,38"/>
<area shape="rect" href="../../df/d67/namespacekcenon_1_1monitoring_1_1hot__path.html#ada0e55ad46d8d53e05317d5296ab4993" title=" " alt="" coords="123,5,307,45"/>
<area shape="poly" title=" " alt="" coords="75,23,109,23,109,28,75,28"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Jan 21 2026 12:10:20 for Monitoring System by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
